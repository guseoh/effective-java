### ✅ 최적화는 신중히 하라

### 0. 들어가기 전

최적화 관련 격언

> (맹목적인 어리석음을 포함해) 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨터 죄악이 더 많다.(심지어 효율을 높이지도 못하면서) - William A. Wulf

> (전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다. - Donald E. Knuth

> 최적화를 할 때 다음 두 규칙을 따르라. - M. A. Jackson
> 1. 하지 마라.
> 2. (전문가 한정) 아직 하지마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지 마라.

이 격언들은 자바가 탄생하기 20년 전에 나온 것으로 최적화의 어두운 진실을 말해줍니다.

## 올바른 설계 및 좋은 최적화 방법

### 1. 빠른 프로그램보다는 좋은 프로그램을 작성하라

```text
견고한 구조가 성능의 기반이다
```

성능 개선을 위해 견고한 구조를 훼손하는 행동은 좋지 않은 행동입니다. 잘 설계된 프로그램은 다음의 이점을 통해 최적화가 안전하게 진행될 수 있습니다.

- 성능 문제가 발생했을 때, 잘 설계된 아키텍처 자체가 문제의 병목 지점을 명확히 알려주어 최적화할 수 있는 길을 자연스럽게 안내해줄 것 입니다.
- 정보 은닉 원칙을 따르므로 개별 구성요소의 내부를 독립적으로 설계
- 시스템의 다른 부분에 영향을 주지 않도록 각 구성 요소의 내부를 재설계하거나 최적화

위에 내용이 프로그램을 완성할 때까지 성능 문제 자체를 무시하라는 의미는 아닙니다. 구현상의 사소한 문제들은 나중에 리팩토링을 통해 비교적 쉽게 해결할 수 있지만, 만약 설계나 아키텍처 자체의 결함으로 인해 성능이
제한되는 상황이라면 시스템 전체를 다시 작성해야 할 수도 있습니다.  
이미 완성된 설계의 틀을 변경하려 할 경우 작업이 많아지고 코드가 꼬이기 쉽기 때문입니다. 따라서 설계 초기 단계에서부터 성능을 반드시 염두에 두어야 합니다.

### 2. 성능을 제한하는 설계를 피하라

애플리케이션 완성 후 가장 변경하기 어려운 요소는 바로 컴포넌트(구성 요소)들이 서로 데이터를 주고받는 방식이거나 외부 시스템(다른 서버, 데이터베이스 등)과 정보를 교환하는 방식입니다.
예를 들어 API, 네트워크 프로토콜, 그리고 영구 저장용 데이터 포맷과 같은 이러한 설계 요소들은 일단 완성되고 나면 변경하기가 어렵거나 심지어 불가능할 수 있으며,
동시에 시스템의 전반적인 성능을 제한하는 요인이 될 수 있습니다.

### 3. API를 설계할 때 성능에 주는 영향을 고려하라

- `public` 타입을 가변으로 만들면 불필요한 방어적 복사를 유발할 수 있습니다. - 아이템 50
    - ex) `java.awt.Dimension`은 가변으로 설계되었기 때문에 매번 방어적 복사를 해야 합니다.
- 컴포지션으로 해결할 수 있음에도 상속으로 설계한 `public`클래스는 상위 클래스에 영원히 종속되며 성능제약까지도 물려 받습니다. - 아이템 18
- 인터페이스를 사용하지 않고 특정 클래스 이름(구현 타입)을 사용하면 특정 구현체에 종속되며, 나중에 더 빠른 구체현가 나오더라도 이용하지 못하게 됩니다.(아이템 64) - OCP원칙, DIP원칙에 위반

### 4. 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다.

여기서 왜곡은 성능을 위해 API의 본래 의도, 명세, 설계 원칙을 무시하고 임의로 비틀거나 수정하는 행위를 말합니다.
이렇게 API를 왜곡하면 다음 릴리스에서 성능 문제를 수정하더라도, 해당 버전을 사용하던 사용자는 이를 인지하지 못한 채 계속 사용하게 되어 문제가 지속될 수 있습니다.

### 5. 각각의 최적화 시도 전후로 성능을 측정하라

최적화 기법은 종종 성능을 크게 향상시키지 못할 뿐 아니라, 오히려 성능을 저하시킬 때도 있습니다. 일반적으로 전체 실행 시간의 약 90%가 전체 코드의 10% 정도에서 소비되며, 따라서 어떤 부분에 최적화 노력을
집중해야 하는지를 찾는 것이 중요합니다. 이를 위해 프로파일링 도구를 사용하게 도움이 되며, `Java`에서는 JProfiler나 JMH와 같은 프로파일링 도구를 활용할 수 있습니다.

### Java 성능 관련 특징 및 단점

`Java`는 다양한 기본 연산의 상대적 비용을 명확히 정의하지 않기 때문에, 최적화에 따른 성능 변화를 일관되게 예측하기가 어렵습니다.
쉽게 말해, 우리가 작성하는 코드와 CPU가 실제로 실행하는 명령어 사이에는 큰 **추상화 간극**이 존재합니다. 이러한 이유로, `Java` 최적화와 관련된 내용 중에는 부분적으로만 맞거나 터무니없는 내용들도
많습니다.  
<br />
`Java`의 성능 모델은 매우 복잡할 뿐 아니라, 구현 시스템(JVM)이나 버전(Java 언어 및 JVM의 버전), 프로세서(CPU)에 따라 달라집니다. 따라서 프로그램을 여러 `Java` 플랫폼(운영체제)이나
다양한 하드웨어 환경(컴퓨터 사양 및 CPU)에서 실행한다면, 각 환경별로 최적화의 효과를 직접 측정해야 합니다. 경우에 따라서는 서로 다른 구현체나 플랫폼 간의 성능을 조율하거나 맞추어야 하는 상황이 발생할 수도
있습니다.

### 한줄 요약

먼저 좋은 구조와 가독성에 집중하고, 느리다면 “측정·분석” 후에 필요한 부분만 최소로 최적화