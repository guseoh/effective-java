### ✅ 자바 직렬화의 대안을 찾으라

직렬화(Serialization)란 객체(그래프)를 [바이트 스트림](https://www.devkuma.com/docs/java/byte-stream/)으로 변환하여 저장하거나 **전송할 수 있게** 만들고,
나중에 그 바이트 스트림을 역직렬화로 다시 객체로 복원하는 메커니즘을 말합니다.

직렬화의 과정에서 생성자가 보이지 않는 방식으로 객체가 만들어지고, API와 내부 구현 사이의 경계가 모호해지며,
잠재적인 정확성 문제, 성능 저하, 보안 취약점, 그리고 유지 보수성의 어려움 등 명확한 단점들이 있었음에도 불구하고,
객체를 파일 저장이나 네트워크 전송을 위해 별도의 파싱 작업 없이 쉽게 바이트 스트림으로 변환해주는 압도적인 편리성과 장점 때문에 그 모든 단점을 감수하고 사용하는 사람들이 있었습니다.

### 직렬화의 근본적인 문제

> 공격 범위가 너무 넓고 지속적으로 더 넓어져 방어하기 어렵다는 점

직렬화의 공격 범위가 넓은 근본적인 이유는 `ObjectInputStream.readObject()` 메서드에 있으며,
이 메서드는 `Serializable` 타입에 정의된 **`readObject()`나 `readResolve()` 같은 훅(Hook)** 을 자동으로 실행해
정식 생성자를 거치지 않고도 객체 그래프를 복원하면서 임의 코드가 실행될 수 있는 위험을 내포하고 있을 뿐 아니라,
외부 바이트 스트림을 해석해 객체로 복원하는 역직렬화 과정에서 `Serializable` 인터페이스를 구현한 클래스패스
안의 거의 모든 타입의 객체를 만들어낼 수 있는 사실상 '마법 같은 생성자' 역할을 하므로, 바이트 스트림을 역직렬화하는 도중에 해당 타입들 안에 있는
모든 코드를 수행할 수 있게 되어 결과적으로 자바 표준
라이브러리나 서드파티 라이브러리는 물론 애플리케이션 자신의 클래스들까지 그 타입들의 코드 전체가 공격 범위에 포함되는 것입니다.

심지어 관련 모든 모범 사례를 적용하고 모든 직렬화 가능 클래스들을 공격에 대비해 신중하게 작성한다고 하더라도, 애플리케이션은 여전히 취약한 상태로 남을 수 있으므로,
오직 아주 신중하게 제작되었다고 확신할 수 있는 바이트 스트림만 역직렬화해야 합니다.

### 가젯 (gadget)

가젯은 역직렬화 과정에서 호출되어 잠재적인 문제를 가지고 있는 메소드(코드)를 의미하며,
이런 가젯들을 연쇄적으로 이어 붙여 최종적으로 위험한 동작으로 이어지게 만든 흐름을 가젯 체인이라고 부릅니다.

### 역직렬화 폭탄 (deserializable bomb)

역직렬화에 시간이 오래 걸리는 짧은 스트림을 역직렬화하는 것만으로도 서비스 거부 공격에 쉽게 노출될 수 있습니다. 이런 스트림을 역직렬화 폭탄이라고 합니다.

역직렬화 폭탄은 역직렬화에 **시간이 오래 걸리는 짧은 바이트 스트림을 의미**하며,
이러한 스트림을 역직렬화하는 것만으로도 서비스 거부(DoS) 공격에 쉽게 노출될 수 있습니다.

#### 코드 예시

```java

static byte[] bomb() {
    Set<Object> root = new HashSet<>();
    Set<Object> s1 = root;
    Set<Object> s2 = new HashSet<>();

    for (int i = 0; i < 100; i++) {
        Set<Object> t1 = new HashSet<>();
        Set<Object> t2 = new HashSet<>();

        t1.add("foo"); // t1을 t2와 다르게 만든다.
        s1.add(t1);
        s1.add(t2);
        s2.add(t1);

        s2.add(t2);
        s1 = t1;
        s2 = t2;
    }

    return serialize(root); // 간결하게 하기 위해 이 메서드의 코드는 생략함
}

```